# BEST 10MW ECRH 控制保护系统 —— 基于 AMD 平台的智能化升级方案

---

**文档版本**: V1.0  
**编制日期**: 2026年2月13日  
**关联文件**: BEST 全超导托克马克 10MW ECRH 控制保护系统总体设计方案 V2.1  
**核心思路**: 识别当前设计中真正受限于计算能力的关键瓶颈，利用 AMD CPU/GPU/FPGA/AI 平台实现质变式提升

---

## 1. 分析方法：不是"全面替换"，而是"精确打击"

当前 ECRH 控制保护系统的大部分功能（电源时序控制、阀门开关、极化器伺服、冷却水监测等）本质上是 **传统工业控制问题**，PLC + 简单 FPGA 完全胜任，没有必要用高性能计算去替代。

真正值得 AMD 平台介入的，是那些 **"当前方案勉强能做，但做得不够好"** 或 **"当前方案用复杂架构才能实现，可以大幅简化"** 的环节。

经过对 V2.1 方案的逐项审查，我识别出 **5 个关键切入点**：

```
当前方案中受计算能力制约的 5 大瓶颈
══════════════════════════════════════════════════════════════════════

  瓶颈 1 ─ NTM 抑制的实时射线追踪：5 ms 勉强够用，无法做全局优化
  瓶颈 2 ─ 破裂预测完全依赖外部 MPS，ECRH 没有自主预判能力
  瓶颈 3 ─ 12 通道 × (PLC + FPGA) 硬件堆叠，系统复杂度高
  瓶颈 4 ─ 56 GB/脉冲数据全量存储，无实时智能分析
  瓶颈 5 ─ 热保护是"阈值报警"，不是"趋势预测"

══════════════════════════════════════════════════════════════════════
```

以下逐一分析每个瓶颈，给出基于 AMD 平台的解决方案。

---

## 2. 方案总览

| 编号 | 升级方案 | AMD 硬件 | 替代/优化的原有环节 | 核心收益 |
|------|---------|---------|-------------------|---------|
| **A** | GPU 加速实时射线追踪 | AMD Instinct GPU | ECRH-MC 中的 CPU 射线追踪算法 | NTM 响应 5ms→**<0.5ms**；可做全局最优搜索 |
| **B** | AI 破裂预测前置层 | AMD Ryzen AI 迷你主机 | 对 MPS 破裂预警的被动等待 | ECRH 获得自主预判能力，多争取 **10-50 ms** |
| **C** | Versal 自适应 SoC 统一通道架构 | AMD/Xilinx Versal | 每通道 PLC + FPGA 双板方案 | 硬件减半，统一编程模型，边缘 AI 能力 |
| **D** | 智能边缘数据节点 | AMD Ryzen AI 迷你主机 | 12+1 套独立 DAQ 系统 | 实时异常标记，数据量降 **10 倍**，在线诊断 |
| **E** | 数字孪生预测性热保护 | AMD EPYC + Instinct GPU | 简单阈值报警保护 | 预测性保护，提高可用功率 **10-15%** |

---

## 3. 方案 A：GPU 加速实时射线追踪 —— NTM 抑制的质变

### 3.1 问题分析

当前方案中，NTM 抑制的关键环节是 **射线追踪（Ray Tracing）**：根据等离子体参数和磁场位形，计算微波束从 Launcher 注入后在等离子体中的传播路径和功率沉积位置。

```
当前方案的 NTM 控制流程:
═══════════════════════════════════════════════════════════════
PCS 给出磁岛位置 ρ_target
    ↓
ECRH-MC 运行射线追踪算法 ← ★ 这一步是计算瓶颈
    ↓ 将 ρ_target 翻译为 Launcher 角度 (θ_pol, θ_tor)
    ↓
下发 Launcher 角度指令
═══════════════════════════════════════════════════════════════

射线追踪的计算量：
  • 每条射线需在非均匀等离子体中求解 ODE（常微分方程组）
  • 需要考虑折射、吸收、模式转换
  • 单条射线 ~10⁴ 步积分
  • 需要同时追踪多条射线（高斯束展宽）
  • 当前 CPU 方案：单次完整射线追踪 ~1-3 ms
  • 如果要搜索最优角度（扫描 100 个候选角度）→ 100-300 ms ← 根本不可能实时做
```

**当前方案的妥协**：因为计算时间限制，ECRH-MC 只能用 **预计算查找表 + 线性插值** 近似，而不是真正的在线全局优化。这意味着：
- 无法在等离子体参数变化时实时优化注入角度
- NTM 抑制效率非最优（可能偏离最佳沉积点）
- 查找表需要预先针对每种磁位形大量离线计算

### 3.2 AMD GPU 解决方案

**核心洞察**：等离子体中的射线追踪与计算机图形学中的光线追踪在数学本质上高度相似——都是大量独立射线的并行 ODE 积分。这正是 GPU 的强项。

```
┌─────────────────────────────────────────────────────────────────┐
│              方案 A：GPU 加速实时射线追踪架构                     │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │                AMD Instinct MI250X / MI300A                │  │
│  │                                                            │  │
│  │  ┌──────────────────────────────────────────────────────┐  │  │
│  │  │           GPU 并行射线追踪内核                        │  │  │
│  │  │                                                      │  │  │
│  │  │   线程块 0:  射线@角度(θ₁,φ₁) ──→ 沉积位置 ρ₁       │  │  │
│  │  │   线程块 1:  射线@角度(θ₂,φ₂) ──→ 沉积位置 ρ₂       │  │  │
│  │  │   线程块 2:  射线@角度(θ₃,φ₃) ──→ 沉积位置 ρ₃       │  │  │
│  │  │      ...                                             │  │  │
│  │  │   线程块 N:  射线@角度(θₙ,φₙ) ──→ 沉积位置 ρₙ       │  │  │
│  │  │                                                      │  │  │
│  │  │   N = 1000~10000 条射线 同时追踪                      │  │  │
│  │  │   每条射线完全独立 → 完美并行                          │  │  │
│  │  └──────────────────────────────────────────────────────┘  │  │
│  │                         ↓                                  │  │
│  │  ┌──────────────────────────────────────────────────────┐  │  │
│  │  │           GPU 归约内核：搜索最优角度                   │  │  │
│  │  │                                                      │  │  │
│  │  │   min |ρ_dep(θ,φ) - ρ_target| → (θ_opt, φ_opt)     │  │  │
│  │  │                                                      │  │  │
│  │  │   同时约束：ECCD 电流驱动效率最大化                    │  │  │
│  │  └──────────────────────────────────────────────────────┘  │  │
│  │                         ↓                                  │  │
│  │               (θ_opt, φ_opt) 最优 Launcher 角度            │  │
│  └────────────────────────────────────────────────────────────┘  │
│                                                                  │
│  性能估算:                                                       │
│  ─────────                                                       │
│  AMD Instinct MI250X: 47.9 TFLOPS FP64                          │
│  单条射线 ~10⁴ 浮点运算 × 1000 条 = 10⁷ 次运算                  │
│  理论耗时: 10⁷ / 47.9×10¹² ≈ 0.0002 ms                         │
│  加上内存传输和内核启动开销，实际 < 0.5 ms                        │
│                                                                  │
│  对比:                                                           │
│  ├── CPU（当前方案）: 单角度 1-3 ms，100角度搜索 100-300 ms      │
│  └── GPU（本方案）: 1000角度全局搜索 < 0.5 ms                    │
│                                                                  │
│  加速比: ~500-1000x                                              │
└─────────────────────────────────────────────────────────────────┘
```

### 3.3 带来的质变

| 指标 | 当前方案（CPU） | GPU 加速方案 | 提升 |
|------|---------------|-------------|------|
| 单次射线追踪 | 1-3 ms | < 0.01 ms | **100x+** |
| NTM 角度优化（搜索 1000 个候选） | 不可能实时做 | **< 0.5 ms** | 从不可能到实时 |
| NTM 控制环路总延迟 | 5 ms（用查找表近似） | **< 1 ms（用真正的全局优化）** | 精度和速度双提升 |
| 等离子体参数变化时的适应性 | 差（查找表固定） | **好（每个周期重新计算）** | 鲁棒性质变 |
| ECCD 电流驱动效率 | 次优 | **可以同时优化沉积位置和驱动效率** | 物理性能提升 |

### 3.4 实施方案

| 项目 | 说明 |
|------|------|
| 硬件 | 1 台 AMD Instinct MI250X 或 MI300A GPU 加速卡，安装在 ECRH-MC 服务器中 |
| 软件 | 基于 ROCm/HIP 开发 GPU 射线追踪内核，移植已有的 TORBEAM/GRAY 等射线追踪代码 |
| 集成 | GPU 射线追踪服务作为 ECRH-MC 的子模块，通过 PCIe 低延迟通信 |
| 备份 | 保留 CPU 查找表方案作为降级后备，GPU 故障时自动切换 |
| 安装位置 | 控制室机房（远离磁场和辐射） |

### 3.5 额外价值：脉冲间离线优化

GPU 在非放电时段可用于：
- 大规模离线射线追踪扫描，生成更密的查找表
- 为下一次放电预计算最优注入方案
- 等离子体物理模拟辅助（输运模拟、平衡计算等）

---

## 4. 方案 B：AI 破裂预测前置层 —— 给 ECRH 自己的"第六感"

### 4.1 问题分析

当前方案中，ECRH 对等离子体破裂的应对完全是 **被动的**：

```
当前方案:
MPS 检测破裂 → 光纤信号 → ECRH 安全 PLC → 快速关断
                    ↑
                这里 ECRH 毫无预判能力
                只能等 MPS 通知后再反应
```

问题：
- MPS 的破裂预测本身有 **误报和漏报**
- ECRH 没有能力区分"真破裂"和"MPS误报"，只能一律关断
- 每次误报都导致等离子体放电中断，浪费实验时间
- ECRH 不了解破裂严重程度，无法做分级响应（轻度降功率 vs 全关断）

### 4.2 AMD AI 迷你主机解决方案

利用一台 AMD Ryzen AI 迷你主机（内置 NPU），部署训练好的 **破裂预测神经网络**，为 ECRH 增加一个独立的智能预判层。

```
┌─────────────────────────────────────────────────────────────────┐
│         方案 B：AI 破裂预测前置层                                 │
│                                                                  │
│         ┌──────────────────────────────────┐                    │
│         │   AMD Ryzen AI 迷你主机           │                    │
│         │   (Ryzen 9 + XDNA NPU)          │                    │
│         │                                  │                    │
│         │   ┌────────────────────────────┐ │                    │
│         │   │  破裂预测 AI 推理引擎       │ │                    │
│         │   │                            │ │                    │
│         │   │  输入特征（从 PCS 实时获取）:│ │                    │
│         │   │  • 等离子体电流 Ip          │ │                    │
│         │   │  • 内感 li                  │ │                    │
│         │   │  • 锁模信号                 │ │                    │
│         │   │  • 密度 / Greenwald 比     │ │                    │
│         │   │  • 辐射功率 / 加热功率比   │ │                    │
│         │   │  • q95                     │ │                    │
│         │   │  • βN                      │ │                    │
│         │   │  • 垂直位移速度 dZ/dt      │ │                    │
│         │   │                            │ │                    │
│         │   │  模型: LSTM / Transformer   │ │                    │
│         │   │  推理延迟: < 1 ms (NPU)    │ │                    │
│         │   │                            │ │                    │
│         │   │  输出:                      │ │                    │
│         │   │  • 破裂概率 P_disrupt       │ │                    │
│         │   │  • 预计破裂时间 t_disrupt   │ │                    │
│         │   │  • 严重程度分类             │ │                    │
│         │   └──────────┬─────────────────┘ │                    │
│         │              │                   │                    │
│         └──────────────┼───────────────────┘                    │
│                        │                                         │
│                        ▼                                         │
│         ┌──────────────────────────────────┐                    │
│         │   ECRH-MC 决策融合模块            │                    │
│         │                                  │                    │
│         │   输入 1: MPS 硬接线信号 (确定性) │                    │
│         │   输入 2: AI 预测结果 (概率性)    │                    │
│         │                                  │                    │
│         │   决策逻辑:                       │                    │
│         │   ┌─────────────────────────────┐│                    │
│         │   │ IF MPS触发 → 立即全关断     ││ ← MPS 仍是最终权威 │
│         │   │ IF AI预警(P>0.8) → 预降功率 ││ ← AI 提供预判      │
│         │   │ IF AI预警(P>0.9) → 预关断   ││                    │
│         │   │ IF MPS触发+AI未预警 → 标记  ││ ← 辅助识别误报     │
│         │   └─────────────────────────────┘│                    │
│         └──────────────────────────────────┘                    │
│                                                                  │
│   ★ 关键原则:                                                   │
│     AI 预测层是"辅助增强"，不替代 MPS 硬联锁                     │
│     MPS 硬联锁仍然是最终安全屏障，SIL-3 等级不变                  │
│     AI 层提供的是"更早的软预警"和"分级响应"能力                   │
└─────────────────────────────────────────────────────────────────┘
```

### 4.3 带来的提升

| 场景 | 当前方案 | AI 增强方案 |
|------|---------|------------|
| 真破裂来临 | 等 MPS 通知后 < 1ms 关断 | **AI 提前 10-50 ms 预降功率，MPS 确认后全关断** |
| MPS 误报 | 一律全关断，放电中断 | **AI 判断 P<0.5 → 标记疑似误报，提醒操作员** |
| 轻度不稳定性 | 无分级响应 | **AI 预警 P=0.5-0.8 → 先降功率观察，避免不必要的全关断** |
| 放电后分析 | 人工复盘 | **AI 自动标记每次放电的不稳定性事件并分类** |

### 4.4 安全性说明

**这个方案绝不改变安全架构**：

| 安全层 | 状态 | 说明 |
|--------|:----:|------|
| MPS 硬接线联锁（SIL-3） | **不变** | 仍然是最终安全屏障 |
| ECRH 安全 PLC（SIL-2/3） | **不变** | 仍然独立于控制系统 |
| FPGA 快速保护（< 100 μs） | **不变** | 硬件保护不受 AI 影响 |
| **+ AI 预测层（新增）** | **新增** | 纯软件辅助层，不参与安全联锁 |

AI 预测层的失效模式是"无预警"（等同于当前方案），不会引入新的安全风险。

### 4.5 实施方案

| 项目 | 说明 |
|------|------|
| 硬件 | 1 台 AMD Ryzen AI 迷你主机（如搭载 Ryzen 9 HX 370 + XDNA2 NPU 50 TOPS） |
| 模型训练 | 使用 EAST/KSTAR/JET 等现有托克马克的历史破裂数据库离线训练 |
| 推理框架 | ONNX Runtime + AMD XDNA NPU 加速，推理延迟 < 1 ms |
| 接口 | 从 PCS 实时获取等离子体参数（反射内存/UDP），输出预警信号给 ECRH-MC |
| 迭代 | BEST 运行积累数据后，持续 fine-tune 模型提升预测精度 |
| 安装位置 | 控制室（ECRH-MC 旁边） |

---

## 5. 方案 C：Versal 自适应 SoC 统一通道控制架构

### 5.1 问题分析

当前方案每个回旋管通道需要 **两套独立硬件**：

```
当前方案（每通道）:
┌──────────────┐   ┌──────────────┐
│ 安全 PLC      │   │ FPGA 板卡    │
│ (SIL-2)      │   │              │
│              │   │              │
│ • 顺序控制   │   │ • 快速保护   │
│ • 慢速联锁   │   │ • 功率调制   │
│ • 状态机     │   │ • 弧光检测   │
│ • 通信       │   │ • 高速 ADC   │
│              │   │              │
└──────┬───────┘   └──────┬───────┘
       │                  │
       │  两套硬件之间     │
       │  需要额外通信     │
       └──────┬───────────┘
              │
              ↓ 两种编程语言、两套工具链、两种调试方法

12 通道 × 2 板 = 24 块板卡 + 24 套机箱/背板/电源
```

问题：
- 硬件数量多，故障点多
- PLC 和 FPGA 使用不同的编程语言和工具链（梯形图 vs HDL）
- 两者之间需要额外的通信接口（增加延迟和复杂度）
- 无法在通道层面做智能分析（PLC 和 FPGA 都没有 AI 能力）

### 5.2 AMD/Xilinx Versal 解决方案

AMD/Xilinx Versal Adaptive SoC 在 **一颗芯片** 上集成了：
- **ARM Cortex-A72 双核** → 替代 PLC 的顺序控制功能
- **可编程逻辑（FPGA 结构）** → 保留 FPGA 的快速保护功能
- **AI Engine（AIE）阵列** → 新增边缘 AI 推理能力
- **高速 I/O 和 ADC 接口** → 直接连接传感器

```
┌─────────────────────────────────────────────────────────────────┐
│      方案 C：Versal Adaptive SoC 统一通道架构                    │
│                                                                  │
│  当前方案 (每通道)            →   Versal 方案 (每通道)           │
│  ┌─────────┐ ┌─────────┐        ┌──────────────────────────┐   │
│  │  PLC    │ │  FPGA   │        │  AMD Versal AI Core      │   │
│  │         │ │         │        │  ┌─────────────────────┐ │   │
│  │ 顺序    │ │ 快速    │        │  │  ARM Cortex-A72     │ │   │
│  │ 控制    │ │ 保护    │   →    │  │  • 顺序控制         │ │   │
│  │         │ │         │        │  │  • 状态机           │ │   │
│  │ 通信    │ │ 功率    │        │  │  • 通信协议栈       │ │   │
│  │ 协议    │ │ 调制    │        │  └─────────────────────┘ │   │
│  └────┬────┘ └────┬────┘        │  ┌─────────────────────┐ │   │
│       │           │             │  │  FPGA 可编程逻辑     │ │   │
│    需要额外通信              │  │  • 快速保护 (<100μs)│ │   │
│    两套工具链                   │  │  • 功率调制 (10kHz) │ │   │
│                                 │  │  • 弧光检测         │ │   │
│  2 块板卡                       │  │  • 高速 ADC 接口    │ │   │
│  2 种编程语言                   │  └─────────────────────┘ │   │
│  2 套工具链                     │  ┌─────────────────────┐ │   │
│                                 │  │  AI Engine 阵列     │ │   │
│                                 │  │  ★ 边缘异常检测     │ │   │
│                                 │  │  ★ 弧光波形智能     │ │   │
│                                 │  │    分类(真弧/噪声)  │ │   │
│                                 │  │  ★ 功率波形异常     │ │   │
│                                 │  │    实时检测         │ │   │
│                                 │  └─────────────────────┘ │   │
│                                 │                          │   │
│                                 │  1 块 SoM 模块           │   │
│                                 │  1 套工具链 (Vitis)      │   │
│                                 └──────────────────────────┘   │
│                                                                  │
│  12 通道合计:                                                    │
│  当前: 12 PLC + 12 FPGA = 24 块板   →   12 块 Versal SoM       │
│  硬件减少 50%                                                    │
│  工具链统一为 AMD Vitis 一套                                      │
└─────────────────────────────────────────────────────────────────┘
```

### 5.3 AI Engine 带来的边缘智能（核心增量价值）

Versal 的 AI Engine 不仅是硬件整合，更带来了当前方案 **完全不具备** 的通道级智能：

| 边缘 AI 功能 | 说明 | 价值 |
|-------------|------|------|
| **弧光波形智能分类** | 当前方案：光电探测器触发 → 一律关断。实际中很多"弧光"触发是噪声干扰（EMI 尖峰、宇宙射线等），导致不必要的关断。AI 分类器在 **< 10 μs** 内区分真弧光和干扰噪声 | **减少 50%+ 的误触发关断**，显著提升系统可用率 |
| **功率波形异常检测** | 实时监测回旋管输出功率波形，检测早期退化征兆（微小的模式竞争、频率偏移） | **故障预警提前数分钟**，避免突发性故障 |
| **收集极热状态估计** | 基于有限温度传感器数据，用 AI 推断收集极内部温度场分布 | **更精确的热保护**，减少保守裕度 |

### 5.4 安全认证考虑

| 关注点 | 解决方案 |
|--------|---------|
| Versal 能否替代 SIL-2 安全 PLC？ | **不能直接替代**。方案中 Versal 替代的是"普通 PLC + FPGA"控制功能。独立的安全 PLC（SIL-2/3）仍然保留，负责最终安全联锁。Versal 的 FPGA 部分可实现快速保护的"第一层"，安全 PLC 作为独立冗余的"第二层"。 |
| AI Engine 推理结果能否用于安全决策？ | **不直接用于安全动作**。AI 结果是"建议"和"标记"，安全动作仍由确定性逻辑执行。AI 可以辅助减少误触发（作为 OR 逻辑中的一个软条件），但不能阻止硬件保护动作。 |

### 5.5 实施方案

| 项目 | 说明 |
|------|------|
| 硬件 | AMD/Xilinx Versal AI Core 系列 SoM (System on Module) × 12 |
| 软件 | AMD Vitis 统一开发平台（HLS 高层综合 + AI 部署） |
| AI 模型 | 弧光分类器和异常检测模型在 Vitis AI 中量化部署到 AI Engine |
| 安全 PLC | **保留**独立安全 PLC（SIL-2），与 Versal 并行运行 |
| 安装位置 | 回旋管大厅控制柜中，每通道一块 Versal SoM 载板 |

---

## 6. 方案 D：智能边缘数据节点 —— 从"全量搬运"到"在线提炼"

### 6.1 问题分析

当前方案每脉冲产生约 **56 GB** 数据，全量存储后离线分析：

```
当前数据流:
12 通道 × 多种传感器 → 1 MHz/100 kHz 采集 → 全量传输至服务器 → 存储 56 GB
                                                                    ↓
                                                             脉冲结束后
                                                             人工/脚本
                                                             离线分析
问题:
  • 56 GB/脉冲 × 每天 20 脉冲 = 1.1 TB/天，存储压力大
  • 运行期间无实时分析，异常事件只能事后发现
  • 大量数据是"正常"的重复波形，信息密度低
  • 13 套独立 DAQ 系统（12通道 + 1系统级），硬件成本高
```

### 6.2 AMD Ryzen AI 迷你主机解决方案

在 **每 2-3 个通道** 部署一台 AMD Ryzen AI 迷你主机作为 **智能边缘数据节点**，实现"采集-分析-压缩-上报"一体化。

```
┌─────────────────────────────────────────────────────────────────┐
│      方案 D：智能边缘数据节点架构                                 │
│                                                                  │
│  当前方案:                                                       │
│  ┌──────┐ ┌──────┐ ┌──────┐      ┌──────┐                      │
│  │DAQ-01│ │DAQ-02│ │DAQ-03│ ···  │DAQ-12│  + DAQ-SYS           │
│  └──┬───┘ └──┬───┘ └──┬───┘      └──┬───┘                      │
│     │        │        │             │       全量数据             │
│     └────────┴────────┴─────────────┘       56 GB/脉冲          │
│                       │                                          │
│                       ▼                                          │
│              ┌────────────────┐                                  │
│              │  存储服务器     │  →  离线分析                     │
│              └────────────────┘                                  │
│                                                                  │
│  Ryzen AI 方案:                                                  │
│  ┌──────────────────┐ ┌──────────────────┐ ┌────────────────┐  │
│  │ Ryzen AI Node A  │ │ Ryzen AI Node B  │ │ Ryzen AI Node C│  │
│  │ (Ch01-Ch04)      │ │ (Ch05-Ch08)      │ │ (Ch09-Ch12)    │  │
│  │                  │ │                  │ │                │  │
│  │ ┌──────────────┐│ │ ┌──────────────┐│ │ ┌─────────────┐│  │
│  │ │ 高速 ADC 接口││ │ │ 高速 ADC 接口││ │ │高速 ADC 接口││  │
│  │ └──────┬───────┘│ │ └──────┬───────┘│ │ └──────┬──────┘│  │
│  │        ↓        │ │        ↓        │ │        ↓       │  │
│  │ ┌──────────────┐│ │ ┌──────────────┐│ │ ┌─────────────┐│  │
│  │ │ 实时 AI 分析 ││ │ │ 实时 AI 分析 ││ │ │实时 AI 分析 ││  │
│  │ │ (NPU加速)   ││ │ │ (NPU加速)   ││ │ │(NPU加速)   ││  │
│  │ │             ││ │ │             ││ │ │            ││  │
│  │ │ • 异常检测  ││ │ │ • 异常检测  ││ │ │• 异常检测  ││  │
│  │ │ • 事件标记  ││ │ │ • 事件标记  ││ │ │• 事件标记  ││  │
│  │ │ • 智能压缩  ││ │ │ • 智能压缩  ││ │ │• 智能压缩  ││  │
│  │ │ • 趋势提取  ││ │ │ • 趋势提取  ││ │ │• 趋势提取  ││  │
│  │ └──────┬───────┘│ │ └──────┬───────┘│ │ └──────┬──────┘│  │
│  │        ↓        │ │        ↓        │ │        ↓       │  │
│  │  精炼数据 + 事件│ │  精炼数据 + 事件│ │ 精炼数据+事件 │  │
│  │  (~2 GB/脉冲)  │ │  (~2 GB/脉冲)  │ │ (~2 GB/脉冲) │  │
│  └────────┬─────────┘ └────────┬─────────┘ └───────┬────────┘  │
│           └────────────────────┼─────────────────────┘           │
│                                ↓                                 │
│                 ┌──────────────────────────┐                    │
│                 │  存储服务器               │                    │
│                 │  ~6 GB/脉冲 (降低 ~90%)  │                    │
│                 │  + 异常事件全分辨率数据  │                    │
│                 └──────────────────────────┘                    │
│                                                                  │
│  数据策略:                                                       │
│  ├── 正常波形: 降采样 + 统计摘要（均值/方差/极值）→ 数据量降 20x │
│  ├── 异常事件: 全分辨率保留（弧光、功率跳变、温度突变）          │
│  ├── 实时标签: AI 自动为每个时间段标注正常/异常/待关注            │
│  └── 趋势数据: 长时间序列的关键参数趋势（1 Hz）→ 永久保留       │
└─────────────────────────────────────────────────────────────────┘
```

### 6.3 带来的提升

| 指标 | 当前方案 | 智能边缘方案 | 提升 |
|------|---------|-------------|------|
| 每脉冲存储量 | 56 GB | **~6 GB** | **降低 ~90%** |
| DAQ 硬件数量 | 13 套独立 DAQ | **3 台迷你主机** | **降低 ~77%** |
| 异常事件发现 | 脉冲后离线分析 | **运行中实时标记** | 从离线到实时 |
| 数据可用性 | 需离线处理后才能分析 | **精炼数据即时可用** | 分析效率大幅提升 |
| 长期存储 | 存储成本高，需定期清理 | **可长期保存全量精炼数据** | 历史数据库更完整 |

### 6.4 实施方案

| 项目 | 说明 |
|------|------|
| 硬件 | 3 台 AMD Ryzen AI 迷你主机（每台管 4 通道），配高速 ADC 采集卡 |
| 软件 | 自研数据采集 + AI 分析框架，模型基于 ONNX + AMD NPU 推理 |
| AI 模型 | 异常检测（自编码器/隔离森林）、波形分类（1D-CNN）、智能压缩 |
| 全分辨率备份 | 异常事件触发时自动保留前后 10 s 的全分辨率数据 |
| 安装位置 | 回旋管大厅控制间（靠近传感器信号源） |

---

## 7. 方案 E：数字孪生预测性热保护

### 7.1 问题分析

当前方案的热保护是纯 **阈值式**：

```
当前方案:
  温度传感器读数 > 阈值 → 报警 / 降功率 / 关断

问题:
  • 阈值是固定的、保守的
  • 不知道"还能安全运行多久"（只知道"已经超温了"）
  • 回旋管收集极内部温度分布不均匀，少量传感器无法完全表征
  • 30分钟稳态运行中，温度缓慢爬升，何时需要降额无法精确预判
  • 为了安全，阈值设得很保守 → 实际运行功率低于设备真实能力
```

### 7.2 AMD EPYC + GPU 数字孪生方案

用一台 AMD EPYC 服务器配 Instinct GPU，运行 ECRH 全系统的 **实时热仿真数字孪生**。

```
┌─────────────────────────────────────────────────────────────────┐
│      方案 E：数字孪生预测性热保护                                 │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │           AMD EPYC 服务器 + Instinct GPU                   │  │
│  │                                                            │  │
│  │  ┌──────────────────────────────────────────────────────┐  │  │
│  │  │              ECRH 热力学数字孪生模型                   │  │  │
│  │  │                                                      │  │  │
│  │  │  实时输入:                                           │  │  │
│  │  │  • 各通道实际功率                                    │  │  │
│  │  │  • 冷却水流量/温度（入口/出口）                       │  │  │
│  │  │  • 环境温度/湿度                                     │  │  │
│  │  │  • 传感器温度测量值（用于校准模型）                   │  │  │
│  │  │                                                      │  │  │
│  │  │  GPU 并行求解:                                       │  │  │
│  │  │  • 12 个回旋管收集极 3D 热传导方程 (FEM)             │  │  │
│  │  │  • 12 条传输线反射镜温度场                           │  │  │
│  │  │  • 4 个 Launcher 镜面温度场                          │  │  │
│  │  │  • 金刚石窗热应力                                    │  │  │
│  │  │                                                      │  │  │
│  │  │  输出:                                               │  │  │
│  │  │  ★ 每个部件的完整温度场（不仅是传感器位置）          │  │  │
│  │  │  ★ 未来 5 分钟温度预测曲线                           │  │  │
│  │  │  ★ "安全运行剩余时间" 估算                           │  │  │
│  │  │  ★ 最优降额策略建议                                  │  │  │
│  │  └──────────────────────────────────────────────────────┘  │  │
│  │                                                            │  │
│  │  计算周期: 每 1 秒更新一次全系统热状态                      │  │
│  │  预测窗口: 5 分钟（可调）                                   │  │
│  └────────────────────────────────────────────────────────────┘  │
│                                                                  │
│  与热保护的集成:                                                 │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │                                                            │  │
│  │  传统保护 (保留):                数字孪生增强 (新增):      │  │
│  │  温度 > 硬阈值 → 联锁关断        预测温度将超标            │  │
│  │  (确定性, SIL-2)                 → 提前 2-5 min 建议降额  │  │
│  │                                  → 自动计算最优降额方案    │  │
│  │                                  → 评估"能否安全撑完脉冲" │  │
│  │                                                            │  │
│  │  两者关系: 传统保护是"底线"，数字孪生是"预见"              │  │
│  └────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

### 7.3 带来的提升

| 指标 | 当前方案 | 数字孪生方案 | 提升 |
|------|---------|-------------|------|
| 保护方式 | 超温后被动响应 | **超温前 2-5 min 主动预警** | 从被动到预测 |
| 温度信息 | 仅传感器点位 | **全部件完整温度场** | 信息量提升 100x |
| 功率裕度利用 | 保守阈值，留 20%+ 裕度 | **精确评估真实热裕度** | 可用功率提升 **10-15%** |
| 降额策略 | 人工经验或简单比例 | **最优化降额（哪个通道降多少最合理）** | 运行效率提升 |
| 长脉冲可靠性 | 依赖经验决定脉冲长度 | **实时预测"能安全运行到何时"** | 运行信心提升 |

### 7.4 实施方案

| 项目 | 说明 |
|------|------|
| 硬件 | 1 台 AMD EPYC 9004 + Instinct MI250X 服务器（可与方案 A 共用同一台） |
| 软件 | GPU 加速 FEM 热仿真（基于 ROCm，可用 OpenFOAM 或自研求解器） |
| 模型校准 | 用实际运行温度数据持续校准仿真模型参数 |
| 接口 | 从 ECRH 数据采集系统获取实时温度/功率/流量数据 |
| 安装位置 | 控制室机房 |

---

## 8. AMD 硬件配置汇总与成本效益分析

### 8.1 新增硬件清单

| 编号 | 设备 | 数量 | 用于方案 | 安装位置 | 参考选型 |
|------|------|------|---------|---------|---------|
| H-01 | GPU 计算服务器 | **1 台** | A + E（共用） | 控制室机房 | AMD EPYC 9654 + 2× Instinct MI250X |
| H-02 | AI 迷你主机（破裂预测） | **1 台** | B | 控制室 | AMD Ryzen AI 9 HX 370 迷你主机 |
| H-03 | Versal SoM 模块 | **12 块** | C | 回旋管大厅 | AMD/Xilinx Versal AI Core VCK190 SoM |
| H-04 | AI 迷你主机（智能 DAQ） | **3 台** | D | 回旋管大厅 | AMD Ryzen AI 9 迷你主机 + PCIe ADC 卡 |

### 8.2 替代/简化的原有硬件

| 原有设备 | 原有数量 | 方案后 | 变化 |
|---------|---------|--------|------|
| 通道 PLC | 12 套 | **取消**（Versal ARM 替代） | -12 |
| 通道 FPGA 板卡 | 12 套 | **取消**（Versal PL 替代） | -12 |
| Versal SoM 模块 | 0 | **新增** | +12 |
| 独立 DAQ 系统 | 13 套 | **3 台迷你主机替代** | -10 |
| ECRH-MC 硬件 | NI PXI 等 | **GPU 服务器可兼任** | 简化 |
| **净变化** | | | **硬件数量大幅减少** |

### 8.3 核心收益总结

```
                        AMD 升级方案核心收益一览
═══════════════════════════════════════════════════════════════════════

  ┌──────────────────────────────────────────────────────────────┐
  │ 方案 A: GPU 射线追踪                                         │
  │ ● NTM 抑制从"查表近似"升级为"实时全局优化"                    │
  │ ● 响应速度 5ms → <0.5ms                                      │
  │ ● 这是物理性能的质变，直接影响 BEST 等离子体约束品质           │
  │ ★★★ 影响等级：极高（提升核心物理能力）                        │
  └──────────────────────────────────────────────────────────────┘

  ┌──────────────────────────────────────────────────────────────┐
  │ 方案 B: AI 破裂预测                                          │
  │ ● ECRH 获得独立预判能力，不再纯被动等 MPS 通知                │
  │ ● 可做分级响应，减少不必要的全关断                            │
  │ ● 安全性只增不减（AI 是辅助层，不替代硬联锁）                 │
  │ ★★☆ 影响等级：高（提升系统可用率和智能化水平）                │
  └──────────────────────────────────────────────────────────────┘

  ┌──────────────────────────────────────────────────────────────┐
  │ 方案 C: Versal 统一通道架构                                   │
  │ ● 12×(PLC+FPGA) → 12× Versal SoM，硬件减半                  │
  │ ● 统一编程模型，降低开发维护成本                              │
  │ ● AI Engine 带来弧光智能分类，减少 50%+ 误触发                │
  │ ★★☆ 影响等级：高（降低系统复杂度，提升可用率）               │
  └──────────────────────────────────────────────────────────────┘

  ┌──────────────────────────────────────────────────────────────┐
  │ 方案 D: 智能边缘数据节点                                      │
  │ ● 数据量降低 90%，存储成本大幅下降                            │
  │ ● 运行中实时异常标记，不再依赖离线分析                        │
  │ ● DAQ 硬件从 13 套降至 3 台迷你主机                           │
  │ ★★☆ 影响等级：高（降低运维成本，提升分析效率）               │
  └──────────────────────────────────────────────────────────────┘

  ┌──────────────────────────────────────────────────────────────┐
  │ 方案 E: 数字孪生预测性热保护                                  │
  │ ● 从被动保护升级为预测性保护                                  │
  │ ● 可用功率提升 10-15%（精确评估热裕度，减少保守设计）         │
  │ ● 30 分钟长脉冲运行信心大幅提升                               │
  │ ★★☆ 影响等级：高（直接提升可用加热功率）                     │
  └──────────────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════════════════
```

---

## 9. 不建议替换的部分

以下环节经分析后，**建议保持当前设计不变**，不适合用 AMD 高性能计算替代：

| 环节 | 保留原因 |
|------|---------|
| **安全 PLC（SIL-2/3）** | 安全认证的独立硬件，替换需重新过安全认证，成本和风险不成比例 |
| **MPS 硬接线联锁** | 物理光纤连接，确定性延迟 < 100 μs，任何软件方案都不应替代最终安全屏障 |
| **Crowbar 放电保护** | 纯硬件电路，< 10 μs 响应，这个层面不涉及计算 |
| **极化器伺服电机控制** | 简单伺服控制，普通驱动器即可，不需要 GPU/AI |
| **冷却水流量/温度监测** | 标准工业仪表，无计算瓶颈 |
| **Launcher 步进电机驱动** | 运动控制器足够，机械响应速度是瓶颈而非计算 |
| **环境湿度/温度监测** | 简单传感器采集和阈值比较，无需 AI |
| **人机界面 (HMI)** | Web 技术已足够，不需要 GPU 渲染 |

**核心哲学**：AMD 高性能硬件用在"计算密集型物理问题"和"海量数据智能分析"上，不用在"开关阀门"和"读温度计"上。

---

## 10. 实施路线图

```
Phase 1 (建设期): 与 ECRH 系统同步设计制造
├── 方案 C: Versal SoM 替代 PLC+FPGA → 需从硬件设计阶段介入
└── 方案 D: 智能 DAQ 节点 → 需从采集系统设计阶段介入

Phase 2 (调试期): ECRH 系统安装调试阶段
├── 方案 A: GPU 射线追踪 → 软件移植和优化
├── 方案 E: 数字孪生 → 建立初始热模型，开始校准
└── 方案 B: AI 破裂预测 → 部署已训练模型，开始验证

Phase 3 (运行期): BEST 装置运行阶段
├── 方案 A: 随运行经验持续优化射线追踪算法
├── 方案 B: 用 BEST 自身数据 fine-tune 破裂预测模型
├── 方案 D: 积累数据，迭代异常检测模型
└── 方案 E: 用运行数据校准数字孪生模型精度
```

---

*本方案聚焦于 ECRH 控制保护系统中真正受限于计算能力的关键瓶颈，利用 AMD CPU/GPU/FPGA/AI 平台实现精确的质变式提升。方案设计遵循"不为替换而替换"的原则，安全相关的硬件联锁架构保持不变，AMD 平台主要在物理计算加速、智能预测和系统简化三个维度创造价值。*
